<div class="message {{ message.type }} animate-slide-in" id="message-{{ message.id }}">
    <div class="message-content">
        <div class="message-header">
            <div class="message-sender">
                {% if message.type == 'user' %}
                    <i class="fas fa-user text-primary"></i> You
                {% else %}
                    <i class="fas fa-robot text-primary"></i> SMS Spam Shield
                {% endif %}
            </div>
            <div class="message-time">{{ message.time }}</div>
        </div>
        <div class="message-text">
            {% if message.type == 'user' %}
                <p>{{ message.text }}</p>
            {% else %}
                <!-- Prediction result -->
                {% if message.result %}
                <div class="prediction-result">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="prediction-category bg-{{ message.result.category_color | default('secondary') }}">
                            {{ message.result.category | default('Unknown') }}
                        </span>
                        <button class="btn btn-sm btn-outline-primary" onclick="showVisualization('{{ message.id }}')">
                            <i class="fas fa-chart-bar"></i> View Details
                        </button>
                    </div>
                    
                    {% set confidence_val = message.result.confidence | default(0) | float %}
                    <div class="prediction-confidence">
                        <span>Confidence:</span>
                        <span class="fw-bold">{{ "%.1f"|format(confidence_val * 100) }}%</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: {{ confidence_val * 100 }}%;"></div>
                        </div>
                    </div>
                    
                    {% if message.result.models %}
                        <div class="model-predictions mt-3">
                            <h6>Model Results:</h6>
                            <div class="row">
                                {% for model in message.result.models %}
                                    <div class="col-md-6 mb-2">
                                        <div class="card">
                                            <div class="card-body p-2">
                                                <div class="d-flex justify-content-between">
                                                    <span class="badge bg-{{ model.color | default('secondary') }}">
                                                        {{ model.name }}
                                                    </span>
                                                    <span class="fw-bold">{{ "%.1f"|format((model.confidence | default(0)) * 100) }}%</span>
                                                </div>
                                                <small class="text-muted">{{ model.prediction }}</small>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                    
                    {% if message.result.explanation %}
                        <div class="explanation mt-3">
                            <h6>AI Explanation:</h6>
                            <div class="explanation-tokens">
                                {% for token in message.result.explanation.tokens %}
                                    <span class="badge bg-info me-1 mb-1">
                                        {{ token.word }}
                                        <small>({{ "%.2f"|format(token.importance) }})</small>
                                    </span>
                                {% endfor %}
                            </div>
                            <p class="mt-2 small">{{ message.result.explanation.text }}</p>
                        </div>
                    {% endif %}
                    
                    <div class="mt-3 text-end">
                        <small class="text-muted">
                            Processed in {{ message.result.processing_time | default(0) }}ms using {{ message.result.model_count | default(0) }} model(s)
                        </small>
                    </div>
                </div>
                {% else %}
                    <div class="alert alert-warning">No prediction result available.</div>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>